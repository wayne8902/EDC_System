# EDC 電子資料擷取系統 - 簡報計畫

## 📋 簡報大綱

### 1. 系統概述 (5分鐘)
- **系統目標**：醫療試驗資料管理與電子化擷取
- **核心功能**：資料創建、瀏覽、編輯、Query 管理、iStone 整合
- **技術架構**：Flask + SQLite/PostgreSQL + 前端 SPA

### 2. 角色權限說明 (10分鐘)

#### 2.1 角色定義
| 角色 | 中文名稱 | 顏色 | 圖示 | 主要職責 |
|------|----------|------|------|----------|
| `system_admin` | 系統管理員 | 紅色 | ⚙️ | 系統設定、權限管理 |
| `sponsor` | 試驗委託者 | 綠色 | 👁️ | 資料查看、監控 |
| `researcher` | 研究人員 | 藍色 | ✏️ | 資料創建、編輯 |
| `investigator` | 試驗主持人 | 黃色 | ✍️ | 資料審核、簽署 |
| `monitor` | 試驗監測者 | 紫色 | 🔍 | 資料監控、Query 管理 |

#### 2.2 權限矩陣
| 功能 | 系統管理員 | 試驗委託者 | 研究人員 | 試驗主持人 | 試驗監測者 |
|------|------------|------------|----------|------------|------------|
| 系統管理 | ✅ | ❌ | ❌ | ❌ | ❌ |
| 資料查看 | ✅ | ✅ | ✅ | ✅ | ✅ |
| 資料創建 | ✅ | ❌ | ✅ | ✅ | ❌ |
| 資料編輯 | ✅ | ❌ | ✅ | ✅ | ❌ |
| 資料簽署 | ✅ | ❌ | ❌ | ✅ | ❌ |
| Query 發起 | ✅ | ❌ | ❌ | ❌ | ✅ |
| Query 回應 | ✅ | ❌ | ❌ | ✅ | ❌ |
| 資料凍結 | ✅ | ❌ | ❌ | ❌ | ✅ |

### 3. 資料創建功能 (8分鐘)

#### 3.1 功能特色
- **動態表單生成**：根據資料庫配置自動生成表單
- **即時驗證**：前端即時資料驗證與錯誤提示
- **權限控制**：僅有 `edc.data.create` 權限用戶可創建

#### 3.2 資料結構
- **受試者資料** (subjects)：基本資料、檢驗結果、影像資料
- **納入條件** (inclusion_criteria)：研究納入標準評估
- **排除條件** (exclusion_criteria)：研究排除標準評估

#### 3.3 技術實作
```javascript
// 動態欄位對應
for (i, col in enumerate(columns)) {
    if (i < len(row)) {
        data[col] = row[i]
    } else {
        data[col] = None
    }
}
```

### 4. 資料瀏覽功能 (8分鐘)

#### 4.1 功能特色
- **多維度篩選**：依狀態、日期、用戶等條件篩選
- **分頁顯示**：大量資料分頁處理
- **即時搜尋**：關鍵字即時搜尋功能
- **狀態管理**：draft → submitted → signed 狀態流程

#### 4.2 路由系統
- **首頁**：`/edc/` - 系統儀表板
- **資料瀏覽**：`/edc/browser` - 資料列表
- **詳細資料**：`/edc/browser/<subject_code>` - 個別受試者詳情

#### 4.3 權限控制
- 所有角色均可瀏覽資料
- 根據角色顯示不同操作按鈕

### 5. 資料編輯功能 (8分鐘)

#### 5.1 編輯權限
- **狀態檢查**：僅 draft 狀態可編輯
- **權限驗證**：需要 `edc.data.edit` 權限
- **建立者檢查**：僅建立者可編輯（部分角色例外）

#### 5.2 編輯流程
1. 載入現有資料
2. 權限與狀態驗證
3. 表單編輯介面
4. 即時驗證與儲存
5. 編輯記錄追蹤

#### 5.3 技術特色
- **動態表單**：根據資料庫結構動態生成
- **版本控制**：保留編輯歷史記錄
- **衝突處理**：多人編輯衝突檢測

### 6. Query 管理系統 (10分鐘)

#### 6.1 Query 發起
- **權限要求**：`edc.query.create` 權限
- **發起流程**：
  1. 選擇受試者資料
  2. 填寫 Query 內容
  3. 指定回應者
  4. 提交 Query

#### 6.2 Query 回應
- **權限要求**：`edc.query.response` 權限
- **回應流程**：
  1. 查看待回應 Query
  2. 填寫回應內容
  3. 標記為已解決
  4. 通知發起者

#### 6.3 Query 狀態管理
- **待回應**：新建立的 Query
- **已回應**：已提供回應的 Query
- **已解決**：Query 已關閉

### 7. iStone 系統整合 (8分鐘)

#### 7.1 整合架構
- **前端介面**：`/edc/istone` - iStone 計算頁面
- **API 串接**：`http://localhost:7000/calc` - 外部計算服務
- **資料儲存**：計算結果自動儲存至 EDC 資料庫

#### 7.2 計算流程
1. 用戶輸入參數 (parm0-parm9)
2. 系統驗證參數完整性
3. 調用 iStone API 計算
4. 生成受試者代碼
5. 儲存計算結果至資料庫

#### 7.3 權限控制
- **前端**：按鈕根據 `edc.data.create` 權限顯示
- **後端**：路由使用 `@require_permission('edc.data.create')` 保護

#### 7.4 資料對應
```python
# 參數對應
parm0: gender (性別)
parm1: age (年齡)
parm2: egfr (腎功能)
parm3: bmi (體重指數)
parm4: ph (尿液酸鹼值)
parm5: dm (糖尿病)
parm6: gout (痛風)
parm7: bac (細菌尿)
parm8: sg (尿液比重)
parm9: rbc (紅血球)
```

### 8. 系統技術架構 (5分鐘)

#### 8.1 後端技術
- **框架**：Flask + Blueprint 架構
- **資料庫**：SQLite/PostgreSQL 支援
- **權限系統**：自建權限管理模組
- **API 設計**：RESTful API 設計

#### 8.2 前端技術
- **架構**：單頁應用程式 (SPA)
- **路由**：前端路由系統
- **模組化**：JavaScript 模組載入系統
- **UI 框架**：Bootstrap + FontAwesome

#### 8.3 安全機制
- **登入驗證**：Flask-Login 整合
- **權限控制**：前後端雙重權限驗證
- **資料驗證**：輸入資料即時驗證
- **SQL 注入防護**：參數化查詢

### 9. 系統優勢與特色 (3分鐘)

#### 9.1 技術優勢
- **模組化設計**：易於維護與擴展
- **權限細粒度控制**：精確的權限管理
- **動態表單生成**：靈活的資料結構支援
- **前後端分離**：清晰的架構分層

#### 9.2 業務優勢
- **符合醫療規範**：完整的資料追蹤機制
- **多角色協作**：支援複雜的醫療試驗流程
- **即時整合**：與 iStone 系統無縫整合
- **資料完整性**：多層驗證確保資料品質

### 10. 未來發展規劃 (2分鐘)

#### 10.1 短期目標
- 完善 Query 管理功能
- 增加資料匯出功能
- 優化使用者介面

#### 10.2 長期目標
- 支援多中心試驗
- 整合更多外部系統
- 增加資料分析功能

---

## 🎯 簡報重點

### 核心賣點
1. **完整的權限管理系統** - 精確控制不同角色的操作權限
2. **動態資料結構** - 靈活適應不同試驗需求
3. **無縫系統整合** - 與 iStone 計算系統完美整合
4. **現代化技術架構** - 前後端分離，易於維護擴展

### 技術亮點
1. **前後端雙重權限驗證** - 確保系統安全性
2. **動態表單生成** - 根據資料庫配置自動生成介面
3. **模組化 JavaScript 架構** - 清晰的代碼組織
4. **RESTful API 設計** - 標準化的介面設計

### 業務價值
1. **提升資料品質** - 多層驗證確保資料準確性
2. **簡化工作流程** - 自動化資料處理流程
3. **增強協作效率** - 多角色協作平台
4. **降低錯誤率** - 即時驗證與權限控制

---

## 📊 簡報時間分配

| 章節 | 時間 | 重點 |
|------|------|------|
| 系統概述 | 5分鐘 | 整體架構介紹 |
| 角色權限 | 10分鐘 | 權限矩陣展示 |
| 資料創建 | 8分鐘 | 動態表單演示 |
| 資料瀏覽 | 8分鐘 | 篩選搜尋功能 |
| 資料編輯 | 8分鐘 | 權限控制機制 |
| Query 管理 | 10分鐘 | 協作流程展示 |
| iStone 整合 | 8分鐘 | 系統整合演示 |
| 技術架構 | 5分鐘 | 技術優勢說明 |
| 系統特色 | 3分鐘 | 核心賣點總結 |
| 未來規劃 | 2分鐘 | 發展方向說明 |

**總計：67分鐘** (建議預留 10-15 分鐘 Q&A)
